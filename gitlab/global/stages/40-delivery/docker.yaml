include:
  - remote: 'https://raw.githubusercontent.com/rios0rios0/pipelines/main/gitlab/global/abstracts/docker-login-push.yaml'
  - remote: 'https://raw.githubusercontent.com/rios0rios0/pipelines/main/gitlab/global/stages/40-delivery/docker-retag.yaml'

delivery:qa:
  extends: '.docker-login-push'
  stage: 'delivery'
  variables:
    TAG: 'latest'
  # TODO: this 'cache' section should be optional
  cache: !reference [ .delivery, cache ]
  script:
    - !reference [ .delivery, script ]
  rules:
    - if: "$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH"

# delivery:prod is now defined in docker-retag.yaml to avoid rebuilds on tag push
