parameters:
  - name: 'SELF_HOSTED_POOL' # optional parameter for heavy workloads within JS language
    type: 'string'
    default: "$(SELF_HOSTED_POOL)"
  - name: 'WORKING_DIRECTORY'
    type: 'string'
    default: ''
  - name: 'RUN_BEFORE_TESTS'
    type: 'string'
    default: 'echo "No before script"'
  - name: 'RUN_AFTER_TESTS'
    type: 'string'
    default: 'echo "No after script"'

steps:
  - script: ${{ parameters.RUN_BEFORE_TESTS }}
    displayName: 'Run Before'

  - script: yarn cy:parallel
    displayName: 'Run Tests'

  - script: ${{ parameters.RUN_AFTER_TESTS }}
    displayName: 'Run After'

  - task: 'PublishTestResults@2'
    inputs:
      testResultsFormat: 'JUnit'
      testResultsFiles: "${{ parameters.WORKING_DIRECTORY }}/**/junit.xml"
    displayName: 'Publish Test Results'

  - task: 'PublishCodeCoverageResults@2'
    inputs:
      summaryFileLocation: "${{ parameters.WORKING_DIRECTORY }}/cobertura.xml"
    displayName: 'Publish Code Coverage Results'
